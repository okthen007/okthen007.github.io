<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"shuo-shuo.site","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Sure&#39;s BLOG">
<meta property="og:url" content="http://shuo-shuo.site/index.html">
<meta property="og:site_name" content="Sure&#39;s BLOG">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Sure Zheng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://shuo-shuo.site/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Sure's BLOG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sure's BLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/About/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">6</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/Categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">7</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">14</span></a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/Schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://shuo-shuo.site/2023/10/19/Checkpoint%E5%8E%9F%E7%90%86%E5%92%8C%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sure Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sure's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/19/Checkpoint%E5%8E%9F%E7%90%86%E5%92%8C%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">Checkpoint原理和机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-10-19 22:00:39 / Modified: 22:52:03" itemprop="dateCreated datePublished" datetime="2023-10-19T22:00:39+08:00">2023-10-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.9k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>4 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Flink-模式下的-Checkpoint"><a href="#Flink-模式下的-Checkpoint" class="headerlink" title="Flink 模式下的 Checkpoint"></a>Flink 模式下的 Checkpoint</h1><p>Flink 的检查点机制，在流处理器中，主要为了 实现数据一致性和容错恢复，Checkpoint能够根据配置周期性地基于Stream中各个Operator/task的状态来生成快照，从而将这些状态数据定期持久化存储下来，当Flink程序一旦意外崩溃时，系统可以在发生故障时回滚，重新运行程序时可以有选择地从这些快照进行恢复，从而修正因为故障带来的程序数据异常。</p>
<p>另一个重要的概念：barrier，barrier将数据流中的记录隔离成一系列的记录集合；barrier被注入到并行流的数据源，注入快照n (称为Sn)的barriers 是数据源中的一个位置，在kafka 就是某个分区的最后一条记录的offset。这个位置Sn后续会汇报给JM的checkpoint 协调器。barrier随着流向下游流动，当中间的operator从他所有的输入流中收到checkpoint n 的barrier时，该operator会将barrier发送给他的下游operator。</p>
<p>JobManager -&gt; Source（发送 barrier）-&gt; 初始化 Checkpoint<br>Source -&gt; 接收 Barrier -&gt; Checkpoint 自己的 state -&gt; 下游发送 Barrier<br>下游收到 Barrier 后，进行 Barrier Alignment 处理<br>Task 开始同步阶段的 Snapshot<br>Task 做完 Checkpoint 之后，再上报 JobManager。</p>
<p>默认checkpoint功能是disabled的，想要使用的时候需要先启用。checkpoint开启之后，默认的checkPointMode是Exactly-once。<br>checkpoint的checkPointMode有两种：<br>Exactly-once: 数据处理且只被处理一次<br>At-least-once：数据至少被处理一次</p>
<h1 id="算法模型下的-Checkpoint"><a href="#算法模型下的-Checkpoint" class="headerlink" title="算法模型下的 Checkpoint"></a>算法模型下的 Checkpoint</h1><p>在模型训练过程中，可以添加检查点(CheckPoint)用于保存模型的参数，以便进行推理及中断后再训练使用。</p>
<p>使用场景如下：</p>
<p>训练后推理场景</p>
<p>模型训练完毕后保存模型的参数，用于推理或预测操作。</p>
<p>训练过程中，通过实时验证精度，把精度最高的模型参数保存下来，用于预测操作。</p>
<p>再训练场景</p>
<p>进行长时间训练任务时，保存训练过程中的CheckPoint文件，防止任务异常退出后从初始状态开始训练。</p>
<p>Fine-tuning（微调）场景，即训练一个模型并保存参数，基于该模型，<br>面向第二个类似任务进行模型训练。</p>
<p>MindSpore的CheckPoint文件是一个二进制文件，存储了所有训练参数的值。采用了Google的Protocol Buffers机制，与开发语言、平台无关，具有良好的可扩展性。 CheckPoint的protocol格式定义在mindspore/ccsrc/utils/checkpoint.proto中。</p>
<p>以下通过一个示例来介绍MindSpore保存和加载的功能，网络选取ResNet-50，数据集为MNIST。</p>
<p>在模型训练的过程中，使用callback机制传入回调函数ModelCheckpoint对象，可以保存模型参数，生成CheckPoint文件。 通过CheckpointConfig对象可以设置CheckPoint的保存策略。 保存的参数分为网络参数和优化器参数。</p>
<h1 id="数据湖版本管理"><a href="#数据湖版本管理" class="headerlink" title="数据湖版本管理"></a>数据湖版本管理</h1><p>Delta Lake：是由 Databricks 推出的一种基于 Apache Spark 和 Apache Parquet 的开源数据湖技术。Delta Lake 提供了 ACID 事务、数据版本控制、数据一致性、数据可靠性、数据质量等功能，使数据湖更加健壮和易于管理。Delta Lake 还支持 SQL 查询、Scala/Python/Java API、Spark Streaming、Delta Lake Connectors 等功能。<br>Apache Hudi：是由 Uber 提出的一种基于 Apache Hadoop 和 Apache Spark 的开源数据湖技术。Hudi 提供了支持增量更新和删除、支持数据版本控制和数据访问控制、支持数据一致性和数据质量控制等功能。Hudi 还支持多种存储格式和存储介质，包括 Parquet、ORC、HDFS、S3、等。<br>Apache Iceberg：是由 Netflix 提出的一种基于 Apache Hadoop 和 Apache Spark 的开源数据湖技术。Iceberg 提供了快速的数据写入和查询操作、数据版本控制、数据质量控制等功能。Iceberg 还支持多种存储介质和存储格式，包括 Parquet、ORC、Avro、HDFS、S3、等。同时，Iceberg 还支持 SQL 查询、Java API、Spark API 等多种数据访问方式。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://shuo-shuo.site/2023/09/18/%E6%B5%81%E5%A4%84%E7%90%86%E6%89%B9%E5%A4%84%E7%90%86%E5%92%8CKappa%E6%9E%B6%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sure Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sure's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/18/%E6%B5%81%E5%A4%84%E7%90%86%E6%89%B9%E5%A4%84%E7%90%86%E5%92%8CKappa%E6%9E%B6%E6%9E%84/" class="post-title-link" itemprop="url">流处理批处理和Kappa架构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-09-18 23:35:00 / Modified: 23:49:17" itemprop="dateCreated datePublished" datetime="2023-09-18T23:35:00+08:00">2023-09-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%B5%81%E6%89%B9%E4%B8%80%E4%BD%93/" itemprop="url" rel="index"><span itemprop="name">流批一体</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>242</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="批处理适合的领域"><a href="#批处理适合的领域" class="headerlink" title="批处理适合的领域"></a>批处理适合的领域</h1><ul>
<li>数据探索、机器学习实验，需要使用批处理来反复验证不同的算法</li>
<li>大规模并行处理</li>
<li>数据来源通常为 Hive、HDFS</li>
<li>数据时效性要求不高，可以支持 T+1 数据延迟</li>
</ul>
<h1 id="流批一体-Kappa-架构适合的领域"><a href="#流批一体-Kappa-架构适合的领域" class="headerlink" title="流批一体 Kappa 架构适合的领域"></a>流批一体 Kappa 架构适合的领域</h1><ul>
<li>逻辑固定的数据预处理流程（统计一个时间段内商品的曝光和购买次数、某些关键词的搜索次数等）</li>
<li>离线/实时 各落一份数据</li>
</ul>
<p>栈，后进先出（Last in First Out）</p>
<ul>
<li>顺序结构，使用数组实现</li>
<li>链式结构，使用链表实现</li>
</ul>
<p>队列，先进先出（First in First Out）</p>
<ul>
<li>顺序结构，使用数组实现</li>
<li>链式结构，使用链表实现</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://shuo-shuo.site/2023/09/10/%E5%88%9D%E8%AF%86%E6%95%B0%E6%8D%AE%E6%B9%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sure Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sure's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/10/%E5%88%9D%E8%AF%86%E6%95%B0%E6%8D%AE%E6%B9%96/" class="post-title-link" itemprop="url">初识数据湖</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-09-10 22:46:50" itemprop="dateCreated datePublished" datetime="2023-09-10T22:46:50+08:00">2023-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-11 23:19:21" itemprop="dateModified" datetime="2023-09-11T23:19:21+08:00">2023-09-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>733</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="大数据的现状"><a href="#大数据的现状" class="headerlink" title="大数据的现状"></a>大数据的现状</h1><p>近年来，湖仓一体架构在大数据领域很受青睐，顾名思义，湖仓一体式将数据湖和数据仓库集成起来的架构，以数据湖为中心，周边集成了云上数据服务，包括数据仓库、机器学习、大数据处理、关系型数据库、非关系型数据库、搜索服务等。其中入湖入仓，湖仓打通、数据出湖、数据处理和数据消费，将各种云上数据服务集成到一起。</p>
<h1 id="数据湖简介"><a href="#数据湖简介" class="headerlink" title="数据湖简介"></a>数据湖简介</h1><p>数据湖中数据包括 结构化数据（关系型数据库）；半结构化数据（CSV、Json、XML等）；非结构化数据/二进制数据（图片、视频）；</p>
<h2 id="数据湖的特性："><a href="#数据湖的特性：" class="headerlink" title="数据湖的特性："></a>数据湖的特性：</h2><ul>
<li>MOR（merge on read）：写入在分析时，类似 github 的 push</li>
<li>Update，只更新单列</li>
<li>更快查询结果、较低存储成本</li>
<li>可用于算法领域，机器学习、预测分析等</li>
</ul>
<h2 id="技术视角分析数据湖："><a href="#技术视角分析数据湖：" class="headerlink" title="技术视角分析数据湖："></a>技术视角分析数据湖：</h2><p>数据湖具备数据管理、数据溯源、流批一体的数据入湖架构，通常数据湖都会支持SQL和可编程的 Flink/Spark 数据处理能力，通常支持有向无环图的工作流模式。<br>最好可以提供一个标准的访问接口，类似于 JDBC 接口可以直接访问数据；</p>
<ul>
<li>风控、推荐、预警（搜索下拉场景，来一条数据处理一条）</li>
<li>日活、留存、转化（CTR场景下，数据探索类应用）</li>
<li>图片、视频存储（多模态场景下，存储多模态数据）</li>
</ul>
<h2 id="阿里云案例-开源生态构建数据湖"><a href="#阿里云案例-开源生态构建数据湖" class="headerlink" title="阿里云案例 - 开源生态构建数据湖"></a>阿里云案例 - 开源生态构建数据湖</h2><ul>
<li>提供数据湖元数据管理、数据湖加速等服务</li>
<li>客户价值1： 通过分层存储，引入多存储类型解决客户温/冷数据长期存储成本优化，让用户资源扩容更加灵活</li>
<li>客户价值2: 计算与存储弹性扩展能力降低管理运维难度，存储与计算的解耦合，让升级更具灵活性</li>
</ul>
<h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><ul>
<li><p>典型的数据湖架构：<br>分布式对象存储+多模态计算引擎+数据管理</p>
</li>
<li><p>典型大数据仓库存储架构：<br>FDM（原始数据） + GDM（整合和拉宽数据） + ADM（轻量汇总数据） + APP（业务定制数据） + DEV层（临时数据）</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://shuo-shuo.site/2023/08/31/pb%E3%80%81parquet%E5%92%8CTFRecord%E6%A0%BC%E5%BC%8F%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%AF%B9%E6%AF%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sure Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sure's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/31/pb%E3%80%81parquet%E5%92%8CTFRecord%E6%A0%BC%E5%BC%8F%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%AF%B9%E6%AF%94/" class="post-title-link" itemprop="url">pb和parquet及TFRecord格式介绍与对比</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-31 21:48:40" itemprop="dateCreated datePublished" datetime="2023-08-31T21:48:40+08:00">2023-08-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-11 23:11:35" itemprop="dateModified" datetime="2023-09-11T23:11:35+08:00">2023-09-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>5 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>大规模数据分析、异构数据源场景、数据、模型等IO要求高场景需要 parquet 数据格式，同样 pb 等序列化结构数据，在数据传输、存储中占用资源较少，因此 PB 文件也广泛的应用于算法之中。</p>
<h1 id="pb（Protocol-Buffers）"><a href="#pb（Protocol-Buffers）" class="headerlink" title="pb（Protocol Buffers）"></a>pb（Protocol Buffers）</h1><p>序列化结构化数据（二进制）适用于数据量大、数据传输效率高的场景</p>
<ul>
<li>序列化后，数据流小，占用网络单款少</li>
<li>序列化和反序列化的性能，占用CPU资源少</li>
<li>数据本身不可读，需要反序列化后可读数据</li>
<li>解析速度快（比 XML、JSON 快20-100倍）</li>
<li>适配算法场景</li>
</ul>
<h1 id="定义pb文件规范"><a href="#定义pb文件规范" class="headerlink" title="定义pb文件规范"></a>定义pb文件规范</h1><ul>
<li>proto文件<figure class="highlight bash"><figcaption><span>创建proto文件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>; <span class="comment"># proto3语法</span></span><br><span class="line"><span class="comment"># 用户服务请求</span></span><br><span class="line">message SearchRequest &#123;</span><br><span class="line">  string query = 1;</span><br><span class="line">  int32 page_number = 2;</span><br><span class="line">  int32 result_per_page = 3;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 服务请求返回</span></span><br><span class="line">message MyRequest &#123;</span><br><span class="line">  string name = 1;</span><br><span class="line">  int32 age = 2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>文件中定义message类型的数据格式<figure class="highlight bash"><figcaption><span>message类型数据格式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一级视图，可作为业务</span></span><br><span class="line"> message MyRequest &#123;</span><br><span class="line">    string name = 1;</span><br><span class="line">    int32 gender = 2;</span><br><span class="line">    optional bytes predict_gender = 3;  <span class="comment"># 算法场景bytes</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 二级视图，可作为特征</span></span><br><span class="line"> message gender &#123;</span><br><span class="line">    string male = 1;</span><br><span class="line">    string female = 2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="数据流-Data2protobuf-Function"><a href="#数据流-Data2protobuf-Function" class="headerlink" title="数据流-Data2protobuf Function"></a>数据流-Data2protobuf Function</h2><ul>
<li>pb 类名（pb 所在完整类名，存储于自定义资产中）</li>
<li>数据类型支持<ul>
<li>byteArray（byte数组转pb）</li>
<li>JSON（json字符串转pb）</li>
</ul>
</li>
</ul>
<h2 id="动态PB"><a href="#动态PB" class="headerlink" title="动态PB"></a>动态PB</h2><p>hive/topic 增加字段，spark/flink 调用 SDK 的入参增加新字段 &lt;dataId, value&gt;, SDK 读取 DUCC 配置感知新增字段，SDK 判断入参增加字段，进行数据更新时，动态增加对字段的序列化/反序列化处理逻辑。</p>
<ul>
<li>键-值 序列化</li>
</ul>
<h1 id="Parquet"><a href="#Parquet" class="headerlink" title="Parquet"></a>Parquet</h1><p>parquet 采用类似 PB 协议来描述存储结果schema。列存储、大数据存储格式、Hadoop 生态圈</p>
<ul>
<li>适用于 OLAP 场景</li>
<li>适用于 模型训练 场景</li>
<li>优势：更高压缩比、更小 IO 操作，适配多语言和组件</li>
<li>行组 + 列块 + 页</li>
</ul>
<p>Parquet 通常和 挂盘功能一并使用，挂载（mounting）是指由操作系统使一个存储设备（诸如硬盘、CD-ROM或共享资源）上的计算机文件和目录可供用户通过计算机的文件系统访问的一个过程。 一般来说，当计算机关机时，每个已挂载存储都将经历一次卸载，以确保所有排队的数据被写入，并保证介质上文件系统结构的完整性。 访问这个目录来访问存储设备。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">message AddressBook &#123;</span><br><span class="line"> required string owner;</span><br><span class="line"> repeated string ownerPhoneNumbers;</span><br><span class="line"> repeated group contacts &#123;</span><br><span class="line">   required string name;</span><br><span class="line">   optional string phoneNumber; </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="TF-Record"><a href="#TF-Record" class="headerlink" title="TF Record"></a>TF Record</h1><p>Tensorflow 自带的数据格式，将数据存储为二进制文件（二进制存储具有占用空间少，拷贝和读取（from disk）更加高效的特点），而且不需要单独的标签文件了，其本质是一行行字节字符串构成的样本数据。</p>
<ul>
<li>训练方式：1、内存； 2、使用 queue/tf.data</li>
<li>优势<ul>
<li>1、支持延迟加载</li>
<li>2、原生tensorflow支持</li>
<li>3、protocol buffer 数据标准</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><figcaption><span>生成 TFRecord文件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import tensorflow as tf</span><br><span class="line"></span><br><span class="line">writer = tf.python_io.TFRecordWriter(<span class="string">&quot;./1.tfrecords&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(200):  <span class="comment"># 假设我们在一个文件中保存200个Example</span></span><br><span class="line">    example = tf.train.Example(...)</span><br><span class="line">    writer.write(example.SerializeToString())</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><figcaption><span>读取TFRecord文件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">def read_demo(filepath):</span><br><span class="line">		<span class="comment"># 定义schema</span></span><br><span class="line">    schema = &#123;</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: tf.FixedLenFeature([], tf.int64),</span><br><span class="line">        <span class="string">&#x27;city_id&#x27;</span>: tf.FixedLenFeature([], tf.int64),</span><br><span class="line">        <span class="string">&#x27;app_type&#x27;</span>: tf.FixedLenFeature([], tf.int64),</span><br><span class="line">        <span class="string">&#x27;viewed_pois&#x27;</span>: tf.VarLenFeature(tf.int64),</span><br><span class="line">        <span class="string">&#x27;avg_paid&#x27;</span>: tf.FixedLenFeature([], tf.float32, default_value=0.0),</span><br><span class="line">        <span class="string">&#x27;comment&#x27;</span>: tf.FixedLenFeature([], tf.string, default_value=<span class="string">&#x27;&#x27;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">		</span><br><span class="line">    <span class="comment"># 使用相关api，按照schema解析dataset中的样本</span></span><br><span class="line">    def _parse_function(example_proto):</span><br><span class="line">        <span class="built_in">return</span> tf.parse_single_example(example_proto, schema)</span><br><span class="line">		</span><br><span class="line">    <span class="comment"># 读取TFRecord文件来创建dataset</span></span><br><span class="line">    dataset = tf.data.TFRecordDataset(filepath)</span><br><span class="line">    <span class="comment">#按照schema解析dataset中的每个样本</span></span><br><span class="line">    parsed_dataset = dataset.map(_parse_function)</span><br><span class="line">    <span class="comment">#创建Iterator并迭代Iterator即可访问dataset中的样本</span></span><br><span class="line">    next = parsed_dataset.make_one_shot_iterator().get_next()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 这里直接利用session，打印dataset中的样本</span></span><br><span class="line">    with tf.Session() as sess:</span><br><span class="line">        <span class="keyword">while</span> True:</span><br><span class="line">            try:</span><br><span class="line">                <span class="built_in">print</span> sess.run(next)</span><br><span class="line">            except:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&quot;out of data&quot;</span></span><br><span class="line">                <span class="built_in">break</span></span><br></pre></td></tr></table></figure>

<h1 id="Json-和-XML-和-ORC"><a href="#Json-和-XML-和-ORC" class="headerlink" title="Json 和 XML 和 ORC"></a>Json 和 XML 和 ORC</h1><p>Json，数据支持好，支持所有编程语言，但不适用于大数据量的传输场景</p>
<p>XML，用于序列化和封装数据。采用键值对的方式，可读性高，压缩数据空间</p>
<p>ORC，列存</p>
<ul>
<li>ORC 嵌套和损耗较大</li>
<li>支持 update 和 ACID</li>
</ul>
<p>Avro，基于行的存储格式，被广泛用作序列化过程。</p>
<ul>
<li>可拆分的</li>
<li>可压缩的</li>
<li>以 Json 定义的 Avro 模式，便于阅读和解析</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://shuo-shuo.site/2023/08/24/%E6%B5%85%E8%B0%88%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%92%8C%E5%BE%AE%E8%B0%83%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sure Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sure's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/24/%E6%B5%85%E8%B0%88%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%92%8C%E5%BE%AE%E8%B0%83%E6%8A%80%E6%9C%AF/" class="post-title-link" itemprop="url">浅谈大模型和微调技术</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-08-24 00:17:10 / Modified: 00:48:33" itemprop="dateCreated datePublished" datetime="2023-08-24T00:17:10+08:00">2023-08-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>694</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="大模型浅谈"><a href="#大模型浅谈" class="headerlink" title="大模型浅谈"></a>大模型浅谈</h1><p>自从chatgpt爆火以来，大模型不断涌现，从 Bert、GPT3、GPT4、Chat-glm，到 Lamma2（Meta AI） 再到 文心、千帆等国产大模型等，各公司都在探索大模型，在大模型中，预训练网络模型往往非常重要，因为模型参数量持续增加，模型预训练耗时很长，训练一个百亿级别的大模型并不简单。</p>
<p>Langchain 架构的涌现使得 通过 Agent 能力动态调用 Chain 成为可能，不同 agent 提供不同解决方案，langchain+chatGLM+本地知识库，也可以提供快速的部署方式搭建本地知识库和AI问答系统。</p>
<h1 id="大模型训练框架"><a href="#大模型训练框架" class="headerlink" title="大模型训练框架"></a>大模型训练框架</h1><p>Pytorch、Tensorflow 无法满足大规模模型训练的需求，因此 Pytorch 开发了 DeepSpeed；腾讯开发了 PatricStar；达摩院开发了 Whale；百度开发了 PaddlePaddle；</p>
<h1 id="大模型微调落地"><a href="#大模型微调落地" class="headerlink" title="大模型微调落地"></a>大模型微调落地</h1><p>预训练大模型+微调方式 更适合长尾常见落地，AIGC 领域 也同样可以 通过 RLHF 等强化学习框架技术来进行微调，从而保证生成内容的有用性、真实性、无害性。</p>
<h2 id="微调技术"><a href="#微调技术" class="headerlink" title="微调技术"></a>微调技术</h2><ul>
<li>Lora 微调，降秩，(稠密矩阵 -&gt; 稀疏矩阵)</li>
<li>Prefix Tuning，最上层的网络增加一个前缀</li>
<li>P-tuning V2，每个网络层前面增加一个前缀，可以tracking每一个层的微调是否有问题</li>
<li>Prompt Tuning（更新 Verbalizer 和 Label的对应关系）</li>
<li>Delta Tuning，多种微调方式组合</li>
<li>SFT（全参数微调），需要更高的 GPU</li>
</ul>
<p>在越大的数据集上，微调方法对于模型准确性来说，影响不大，lora tuning 等可以媲美全参数微调，但对于小模型来说，全参数微调是更好的选择。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://shuo-shuo.site/2023/08/16/ElasticSearch%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E5%8F%AC%E5%9B%9E%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sure Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sure's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/16/ElasticSearch%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E5%8F%AC%E5%9B%9E%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">ElasticSearch 数据库与召回组件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-08-16 21:51:55 / Modified: 23:22:37" itemprop="dateCreated datePublished" datetime="2023-08-16T21:51:55+08:00">2023-08-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/OLAP/" itemprop="url" rel="index"><span itemprop="name">OLAP</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>3.3k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>6 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="推荐系统召回层"><a href="#推荐系统召回层" class="headerlink" title="推荐系统召回层"></a>推荐系统召回层</h1><p>推荐系统的线上服务模块，proxy -&gt; 候选集 -&gt; 召回层 -&gt; 粗排 -&gt; 精排</p>
<h2 id="召回方法"><a href="#召回方法" class="headerlink" title="召回方法"></a>召回方法</h2><ul>
<li>单策略召回</li>
</ul>
<p>通过制定一条规则或者利用一个简单模型（简单直观）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//详见SimilarMovieFlow class</span><br><span class="line">public static List&lt;Movie&gt; candidateGenerator(Movie movie)&#123;</span><br><span class="line">    ArrayList&lt;Movie&gt; candidates = new ArrayList&lt;&gt;();</span><br><span class="line">    //使用HashMap去重</span><br><span class="line">    HashMap&lt;Integer, Movie&gt; candidateMap = new HashMap&lt;&gt;();</span><br><span class="line">    //电影movie包含多个风格标签</span><br><span class="line">    <span class="keyword">for</span> (String genre : movie.getGenres())&#123;</span><br><span class="line">        //召回策略的实现</span><br><span class="line">        List&lt;Movie&gt; oneCandidates = DataManager.getInstance().getMoviesByGenre(genre, 100, <span class="string">&quot;rating&quot;</span>); </span><br><span class="line">        <span class="keyword">for</span> (Movie candidate : oneCandidates)&#123;</span><br><span class="line">            candidateMap.put(candidate.getMovieId(), candidate);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //去掉movie本身</span><br><span class="line">    <span class="keyword">if</span> (candidateMap.containsKey(movie.getMovieId()))&#123;</span><br><span class="line">        candidateMap.remove(movie.getMovieId());</span><br><span class="line">    &#125;</span><br><span class="line">    //最终的候选集</span><br><span class="line">    <span class="built_in">return</span> new ArrayList&lt;&gt;(candidateMap.values());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>多路召回策略<br>计算速度和召回率之间进行权衡的结果</li>
</ul>
<p>风格类型、高分评价、最新上映，这三路召回策略组成的多路召回方法<br>（其他方法：多线程并行；建立标签、特征索引；建立常用召回集缓存；）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public static List&lt;Movie&gt; multipleRetrievalCandidates(List&lt;Movie&gt; userHistory)&#123;</span><br><span class="line">    HashSet&lt;String&gt; genres = new HashSet&lt;&gt;();</span><br><span class="line">    //根据用户看过的电影，统计用户喜欢的电影风格</span><br><span class="line">    <span class="keyword">for</span> (Movie movie : userHistory)&#123;</span><br><span class="line">        genres.addAll(movie.getGenres());</span><br><span class="line">    &#125;</span><br><span class="line">    //根据用户喜欢的风格召回电影候选集</span><br><span class="line">    HashMap&lt;Integer, Movie&gt; candidateMap = new HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String genre : genres)&#123;</span><br><span class="line">        List&lt;Movie&gt; oneCandidates = DataManager.getInstance().getMoviesByGenre(genre, 20, <span class="string">&quot;rating&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Movie candidate : oneCandidates)&#123;</span><br><span class="line">            candidateMap.put(candidate.getMovieId(), candidate);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //召回所有电影中排名最高的100部电影</span><br><span class="line">    List&lt;Movie&gt; highRatingCandidates = DataManager.getInstance().getMovies(100, <span class="string">&quot;rating&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Movie candidate : highRatingCandidates)&#123;</span><br><span class="line">        candidateMap.put(candidate.getMovieId(), candidate);</span><br><span class="line">    &#125;</span><br><span class="line">    //召回最新上映的100部电影</span><br><span class="line">    List&lt;Movie&gt; latestCandidates = DataManager.getInstance().getMovies(100, <span class="string">&quot;releaseYear&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Movie candidate : latestCandidates)&#123;</span><br><span class="line">        candidateMap.put(candidate.getMovieId(), candidate);</span><br><span class="line">    &#125;</span><br><span class="line">    //去除用户已经观看过的电影</span><br><span class="line">    <span class="keyword">for</span> (Movie movie : userHistory)&#123;</span><br><span class="line">        candidateMap.remove(movie.getMovieId());</span><br><span class="line">    &#125;</span><br><span class="line">    //形成最终的候选集</span><br><span class="line">    <span class="built_in">return</span> new ArrayList&lt;&gt;(candidateMap.values());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ElasticSearch-数据库"><a href="#ElasticSearch-数据库" class="headerlink" title="ElasticSearch 数据库"></a>ElasticSearch 数据库</h1><p>【非关系型数据库】搜索引擎数据库，内核基于 Lucene 构建，适用 Json 来承载数据，提供 RESTful API</p>
<h2 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h2><ul>
<li>Node（节点）</li>
<li>Cluster（集群），一个或多个node</li>
<li>Index（索引），类似于数据库概念</li>
<li>Type（类型），类似于表概念</li>
<li>Document（文档），可被索引的基础信息单元，数据某一行</li>
<li>Field（列），数据某一列</li>
<li>shard（分片），创建一个索引可以指定分成多少个分片</li>
<li>Replication（备份），一个分片可以有多个备份（副本）</li>
</ul>
<h2 id="技术痛点"><a href="#技术痛点" class="headerlink" title="技术痛点"></a>技术痛点</h2><p>倒排序核心算法<br>ES 支持滚动索引（日期/序号/日期+序号），支持写入时清理策略</p>
<h2 id="查询-DSL"><a href="#查询-DSL" class="headerlink" title="查询 DSL"></a>查询 DSL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /ad/phone/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;match&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:<span class="string">&quot;phone&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>查询所有</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /ad/phone/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>复合查询</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">GET /ad/phone/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;must&quot;</span>: [</span><br><span class="line">        &#123;<span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;phone&quot;</span></span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">      , <span class="string">&quot;must_not&quot;</span>: [</span><br><span class="line">        &#123;<span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;color&quot;</span>: <span class="string">&quot;red&quot;</span></span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">      , <span class="string">&quot;should&quot;</span>: [</span><br><span class="line">        &#123;<span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;price&quot;</span>: 5000</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">      , <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;label&quot;</span>: <span class="string">&quot;phone&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ES-数据库做召回引擎"><a href="#ES-数据库做召回引擎" class="headerlink" title="ES 数据库做召回引擎"></a>ES 数据库做召回引擎</h2><p>电商实体识别，全称命名实体识别（Named Entity Recognition，简称NER），指对查询词中的具有特定意义的语义实体进行识别。查询分析根据识别的结果，依据实体类型的权重对查询词进行改写，使得召回的文档符合查询的意图。</p>
<h2 id="ES-数据库做质量监控"><a href="#ES-数据库做质量监控" class="headerlink" title="ES 数据库做质量监控"></a>ES 数据库做质量监控</h2><p>日志管理与分析（日志采集、存储、查询设计）、安全指标监控（Elastic Stack产品生态）、应用性能监控、Web抓取舆情分析</p>
<h2 id="ES-数据库与机器学习"><a href="#ES-数据库与机器学习" class="headerlink" title="ES 数据库与机器学习"></a>ES 数据库与机器学习</h2><p>异常检测类型，无监督学习<br>数据帧分析，分类与回归</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://shuo-shuo.site/2023/08/14/ClickHouse%E4%B8%8EDoris%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sure Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sure's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/14/ClickHouse%E4%B8%8EDoris%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">ClickHouse 与 Doris 数据库深度分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-14 22:30:35" itemprop="dateCreated datePublished" datetime="2023-08-14T22:30:35+08:00">2023-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-11 23:12:15" itemprop="dateModified" datetime="2023-09-11T23:12:15+08:00">2023-09-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/OLAP/" itemprop="url" rel="index"><span itemprop="name">OLAP</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>5 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="OLAP-数据库（计算-amp-存储一体）"><a href="#OLAP-数据库（计算-amp-存储一体）" class="headerlink" title="OLAP 数据库（计算 &amp; 存储一体）"></a>OLAP 数据库（计算 &amp; 存储一体）</h1><h2 id="ClickHouse-几大特点（By-Yandex）："><a href="#ClickHouse-几大特点（By-Yandex）：" class="headerlink" title="ClickHouse 几大特点（By Yandex）："></a>ClickHouse 几大特点（By Yandex）：</h2><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><p>起源于 网站流量分析服务</p>
<ul>
<li>MPP 架构（列存储）</li>
<li>数据 “批” 写入（写入太频繁会导致小文件）</li>
<li>宽表，明细表存储</li>
<li>大数据量单表聚合查询</li>
<li>对数据一致性要求低</li>
<li>支持 Ad-hoc 查询</li>
<li>向量化执行引擎</li>
</ul>
<h3 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h3><ul>
<li>避免多表查询</li>
<li>避免高并发数据查询</li>
</ul>
<h3 id="业务研发中局限性"><a href="#业务研发中局限性" class="headerlink" title="业务研发中局限性"></a>业务研发中局限性</h3><ul>
<li>spark 不支持处理 CK uint64的格式</li>
<li>flink sql 不支持处理 map、tuple 类型的数据</li>
</ul>
<h3 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h3><figure class="highlight bash"><figcaption><span>建本地表</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS zypp_zzh.zs_zypprb_sku_ord_v1_local ON CLUSTER LF0_CK_Pub_15 (</span><br><span class="line">  dates String,</span><br><span class="line">  sale_ord_id String,</span><br><span class="line">  item_sku_id String,</span><br><span class="line">  gmv UInt64,</span><br><span class="line">  rev UInt64,</span><br><span class="line">  zm UInt64,</span><br><span class="line">  biaoji String,</span><br><span class="line">  daiding2 String,</span><br><span class="line">  daiding3 String,</span><br><span class="line">  zm_notax UInt64,</span><br><span class="line">  dt String,</span><br><span class="line">  channel String</span><br><span class="line">) ENGINE = ReplicatedMergeTree(<span class="string">&#x27;/clickhouse/LF0_CK_Pub_15/jdob_ha/zypp_zzh/zs_zypprb_sku_ord_v1_local/&#123;shard&#125;&#x27;</span>, <span class="string">&#x27;&#123;replica&#125;&#x27;</span>) </span><br><span class="line">// jdob_ha，固定</span><br><span class="line">PARTITION BY (dt, channel)</span><br><span class="line">ORDER BY (gmv) TTL toDate(dt) + INTERVAL 720 DAY </span><br><span class="line">SETTINGS storage_policy =<span class="string">&#x27;jdob_ha&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>建分布式表</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS zypp_zzh.zs_zypprb_sku_ord_v1_dist ON CLUSTER LF0_CK_Pub_15 (</span><br><span class="line">  dates String,</span><br><span class="line">  sale_ord_id String,</span><br><span class="line">  item_sku_id String,</span><br><span class="line">  gmv UInt64,</span><br><span class="line">  rev UInt64,</span><br><span class="line">  zm UInt64,</span><br><span class="line">  biaoji String,</span><br><span class="line">  daiding2 String,</span><br><span class="line">  daiding3 String,</span><br><span class="line">  zm_notax UInt64,</span><br><span class="line">  dt String,</span><br><span class="line">  channel String</span><br><span class="line">) ENGINE = Distributed(</span><br><span class="line">  LF0_CK_Pub_15,</span><br><span class="line">  zypp_zzh,</span><br><span class="line">  zs_zypprb_sku_ord_v1_local,</span><br><span class="line">  rand()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="Doris-几大特点（By-Baidu）："><a href="#Doris-几大特点（By-Baidu）：" class="headerlink" title="Doris 几大特点（By Baidu）："></a>Doris 几大特点（By Baidu）：</h2><p>源自在线广告系统，偏交易系统数据分析</p>
<ul>
<li>MPP 架构（列存储）</li>
<li>数据 “批” 写入（写入太频繁会导致小文件）</li>
<li>主键更新（merge on read）</li>
<li>支持 Ad-hoc 查询</li>
<li>支持原生导数功能</li>
</ul>
<h2 id="OLAP-数据库业务场景"><a href="#OLAP-数据库业务场景" class="headerlink" title="OLAP 数据库业务场景"></a>OLAP 数据库业务场景</h2><ul>
<li>主要用来做快速即席查询（Ad-Hoc 产品）</li>
<li>用来作为实时数据仓库的选型</li>
<li>可以作为 实时看板、大屏的 数据源</li>
<li>用户画像（一张或多张用户的特征表），用户数据的圈人服务（将数据同步到 CK 进行聚合查询、快速圈人）</li>
<li>实时监控（Flink -&gt; Grafana）</li>
<li>用户行为分析（路径分析、漏斗分析）</li>
</ul>
<h3 id="实操-1"><a href="#实操-1" class="headerlink" title="实操"></a>实操</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS test_doris.example_tbl</span><br><span class="line">(</span><br><span class="line">    `timestamp` DATE NOT NULL COMMENT <span class="string">&quot;[&#x27;0000-01-01&#x27;, &#x27;9999-12-31&#x27;]&quot;</span>,</span><br><span class="line">    `<span class="built_in">type</span>` TINYINT NOT NULL COMMENT <span class="string">&quot;[-128, 127]&quot;</span>,</span><br><span class="line">    `error_code` INT COMMENT <span class="string">&quot;[-2147483648, 2147483647]&quot;</span>,</span><br><span class="line">    `error_msg` VARCHAR(300) COMMENT <span class="string">&quot;[1-65533]&quot;</span>,</span><br><span class="line">    `op_id` BIGINT COMMENT <span class="string">&quot;[-9223372036854775808, 9223372036854775807]&quot;</span>,</span><br><span class="line">    `op_time` DATETIME COMMENT <span class="string">&quot;[&#x27;0000-01-01 00:00:00&#x27;, &#x27;9999-12-31 23:59:59&#x27;]&quot;</span>,</span><br><span class="line">    `target` <span class="built_in">float</span> COMMENT <span class="string">&quot;4 字节&quot;</span>,</span><br><span class="line">    `<span class="built_in">source</span>` double COMMENT <span class="string">&quot;8 字节&quot;</span>,</span><br><span class="line">    `lost_cost` decimal(12,2) COMMENT <span class="string">&quot;&quot;</span>,</span><br><span class="line">    `remark` string COMMENT <span class="string">&quot;1m size&quot;</span>,</span><br><span class="line">    `op_userid` LARGEINT COMMENT <span class="string">&quot;[-2^127 + 1 ~ 2^127 - 1]&quot;</span>,</span><br><span class="line">    `plate` SMALLINT COMMENT <span class="string">&quot;[-32768, 32767]&quot;</span>,</span><br><span class="line">    `iscompleted` boolean COMMENT <span class="string">&quot;true 或者 false&quot;</span></span><br><span class="line">)</span><br><span class="line">DUPLICATE KEY(`timestamp`, `<span class="built_in">type</span>`)</span><br><span class="line">DISTRIBUTED BY HASH(`<span class="built_in">type</span>`) BUCKETS 1</span><br><span class="line">PROPERTIES (</span><br><span class="line">    <span class="string">&quot;replication_allocation&quot;</span> = <span class="string">&quot;tag.location.default: 1&quot;</span></span><br><span class="line">); </span><br></pre></td></tr></table></figure>


<h1 id="ClickHouse-VS-Doris-VS-StarRocks"><a href="#ClickHouse-VS-Doris-VS-StarRocks" class="headerlink" title="ClickHouse VS Doris VS StarRocks"></a>ClickHouse VS Doris VS StarRocks</h1><ul>
<li>都是 MPP 架构数据库</li>
<li>StarRocks 建立在 Hadoop 之上，通过 HDFS来存储数据</li>
<li>CK在查询时，需要去除重复数据；Doris在insert时做聚合；</li>
<li>StarRocks优势：兼容 Mysql 协议；全面向量化执行；丰富数据模型（明细、聚合、主键、更新模型[merge on read]）</li>
<li>ClickHouse优势：主索引&amp;二级索引；MergeTree表；计算算子全面向量化</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://shuo-shuo.site/2023/08/14/Spark%E4%B8%8E%E7%A6%BB%E7%BA%BF%E8%AF%84%E4%BC%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sure Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sure's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/14/Spark%E4%B8%8E%E7%A6%BB%E7%BA%BF%E8%AF%84%E4%BC%B0/" class="post-title-link" itemprop="url">Spark 与离线评估</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-14 21:55:52" itemprop="dateCreated datePublished" datetime="2023-08-14T21:55:52+08:00">2023-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-11 23:11:51" itemprop="dateModified" datetime="2023-09-11T23:11:51+08:00">2023-09-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E7%AE%97%E6%B3%95/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>942</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<h1 id="模型离线评估方法"><a href="#模型离线评估方法" class="headerlink" title="模型离线评估方法"></a>模型离线评估方法</h1><h2 id="HoldOut-检验"><a href="#HoldOut-检验" class="headerlink" title="HoldOut 检验"></a>HoldOut 检验</h2><p>随机分为，训练集和测试集（70%训练集；30%测试集）</p>
<h2 id="交叉检验"><a href="#交叉检验" class="headerlink" title="交叉检验"></a>交叉检验</h2><p>消除随机性，k个验证集和测试集</p>
<h2 id="自助法（Bootstrap）"><a href="#自助法（Bootstrap）" class="headerlink" title="自助法（Bootstrap）"></a>自助法（Bootstrap）</h2><p>自助采样的验证方法，N次有放回的随机抽样（改变原有数据的分布，产生偏差）</p>
<h2 id="时间切割"><a href="#时间切割" class="headerlink" title="时间切割"></a>时间切割</h2><p>t时刻，t+1时刻（未来信息），分布在 (t0, tn)， 时间切割划分测试集和训练集，切割比例, 3:1 OR 10:1，缺点：评估过程静态</p>
<h2 id="离线-Replay"><a href="#离线-Replay" class="headerlink" title="离线 Replay"></a>离线 Replay</h2><p>离线状态下对线上更新过程进行仿真，让整个评估过程“动”起来</p>
<h1 id="基于-Spark-的离线评估方法实操"><a href="#基于-Spark-的离线评估方法实操" class="headerlink" title="基于 Spark 的离线评估方法实操"></a>基于 Spark 的离线评估方法实操</h1><figure class="highlight bash"><figcaption><span>Spark 随机划分测试集和训练集</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val Array(trainingSamples, testSamples) = samples.randomSplit(Array(0.9, 0.1))</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>交叉检验接口</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val cv = new CrossValidator()</span><br><span class="line">  .setEstimator(modelPipeline) <span class="comment"># 评估对象，构建模型pipeline</span></span><br><span class="line">  .setEvaluator(new BinaryClassificationEvaluator)  <span class="comment"># 设置评估所用的方法和指标</span></span><br><span class="line">  .setEstimatorParamMaps(paramGrid) </span><br><span class="line">  .setNumFolds(10)  // Use 3+ <span class="keyword">in</span> practice <span class="comment"># 交叉检验中 k 的值</span></span><br><span class="line">val cvModel = cv.fit(training)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//找到时间切割点</span><br><span class="line">val quantile = smallSamples.stat.approxQuantile(<span class="string">&quot;timestampLong&quot;</span>, Array(0.8), 0.05)</span><br><span class="line">val splitTimestamp = quantile.apply(0)</span><br><span class="line">//切割样本为训练集和测试集</span><br><span class="line">val training = smallSamples.<span class="built_in">where</span>(col(<span class="string">&quot;timestampLong&quot;</span>) &lt;= splitTimestamp).drop(<span class="string">&quot;timestampLong&quot;</span>)</span><br><span class="line">val <span class="built_in">test</span> = smallSamples.<span class="built_in">where</span>(col(<span class="string">&quot;timestampLong&quot;</span>) &gt; splitTimestamp).drop(<span class="string">&quot;timestampLong&quot;</span>)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://shuo-shuo.site/2023/08/09/%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E4%B8%8ERPC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sure Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sure's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/09/%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E4%B8%8ERPC/" class="post-title-link" itemprop="url">模型服务与 RPC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-09 22:23:57" itemprop="dateCreated datePublished" datetime="2023-08-09T22:23:57+08:00">2023-08-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-11 23:12:07" itemprop="dateModified" datetime="2023-09-11T23:12:07+08:00">2023-09-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.3k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>4 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="业界主流模型服务方法"><a href="#业界主流模型服务方法" class="headerlink" title="业界主流模型服务方法"></a>业界主流模型服务方法</h1><h2 id="预存推荐结果或-Embedding-结果"><a href="#预存推荐结果或-Embedding-结果" class="headerlink" title="预存推荐结果或 Embedding 结果"></a>预存推荐结果或 Embedding 结果</h2><p>离线结果预存到 Redis 数据库中，线上环境直接取出预存数据推荐给用户<br>优点：<br>1、线上服务平台与线下离线模型训练完全解耦<br>2、线上没有复杂计算，推荐系统线上延迟低<br>缺点：<br>1、用户、物品数量规模过大时，线上数据库无法支撑大规模结果的存储<br>2、无法引入线上场景类特征，推荐结果灵活性、效果受限<br>适用场景：<br>用户规模小、冷启动、热门榜单</p>
<p>用户规模大，存储embedding，线上通过相似度运算得到推算结果（Item2vec、Graph Embedding -&gt; Redis）</p>
<h2 id="预训练-Embedding-轻量级线上模型"><a href="#预训练-Embedding-轻量级线上模型" class="headerlink" title="预训练 Embedding + 轻量级线上模型"></a>预训练 Embedding + 轻量级线上模型</h2><p>复杂深度学习网络离线训练生成 embedding，存入内存数据库 + 线上实现逻辑回归或浅层神经网络等轻量级模型来拟合优化目标<br>eg. MIMN 模型：“多通道用户兴趣向量”，这些 Embedding 向量就是连接离线模型和线上模型部分的接口</p>
<h2 id="利用-PMML-转换和部署模型"><a href="#利用-PMML-转换和部署模型" class="headerlink" title="利用 PMML 转换和部署模型"></a>利用 PMML 转换和部署模型</h2><ul>
<li>END2END 训练 + END2END部署<br>PMML (Predictive Model Markup Language, PMML) 预测模型标记语言，连接离线训练平台和模型服务模块 - XML形式<br>eg. spark MLlib<br>Spark: 完成 Spark MLlib 模型的<strong>序列化</strong>，生成<strong>PMML</strong>文件，并且把它保存到线上服务器能够触达的数据库或文件系统中<br>Java Server: <strong>解析</strong>模型，生成预估模型，完成了与业务逻辑的整合。<br>JPMML: 在 Java Server 部分只进行<strong>推断</strong>，不考虑模型训练、分布式部署等一系列问题<h3 id="代码参考"><a href="#代码参考" class="headerlink" title="代码参考"></a>代码参考</h3>JPMML[<a target="_blank" rel="noopener" href="https://github.com/jpmml]">https://github.com/jpmml]</a><br>MLeap[<a target="_blank" rel="noopener" href="https://github.com/combust/mleap]">https://github.com/combust/mleap]</a></li>
</ul>
<h2 id="Tensorflow-Serving"><a href="#Tensorflow-Serving" class="headerlink" title="Tensorflow Serving"></a>Tensorflow Serving</h2><p>模型存储（序列化） -&gt; 模型载入还原 -&gt; 提供模型服务（HTTP/gRPC）</p>
<h3 id="实操-Docker中"><a href="#实操-Docker中" class="headerlink" title="实操(Docker中)"></a>实操(Docker中)</h3><figure class="highlight bash"><figcaption><span>请求模型服务API</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从docker仓库中下载tensorflow/serving镜像</span></span><br><span class="line">docker pull tensorflow/serving</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>把tensorflow/serving的测试代码clone到本地</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/tensorflow/serving</span><br><span class="line"><span class="comment"># 指定测试数据的地址</span></span><br><span class="line">TESTDATA=<span class="string">&quot;<span class="subst">$(pwd)</span>/serving/tensorflow_serving/servables/tensorflow/testdata&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>启动TensorFlow Serving容器</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在8100端口运行模型服务API</span></span><br><span class="line">docker run -t --<span class="built_in">rm</span> -p 8100:8100 \</span><br><span class="line">    -v <span class="string">&quot;<span class="variable">$TESTDATA</span>/saved_model_half_plus_two_cpu:/models/half_plus_two&quot;</span> \</span><br><span class="line">    -e MODEL_NAME=half_plus_two \</span><br><span class="line">    tensorflow/serving &amp;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><figcaption><span>调用API</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -d <span class="string">&#x27;&#123;&quot;instances&quot;: [1.0, 2.0, 5.0]&#125;&#x27;</span> \</span><br><span class="line">    -X POST http://localhost:8501/v1/models/half_plus_two:predict</span><br></pre></td></tr></table></figure>
<h1 id="构建-API-RPC（远程调用）、REST（表征状态传输）"><a href="#构建-API-RPC（远程调用）、REST（表征状态传输）" class="headerlink" title="构建 API - RPC（远程调用）、REST（表征状态传输）"></a>构建 API - RPC（远程调用）、REST（表征状态传输）</h1><figure class="highlight bash"><figcaption><span>接口</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@app.route(<span class="string">&#x27;/predict&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>])  <span class="comment"># Your API endpoint URL would consist /predict</span></span><br><span class="line">def predict():</span><br><span class="line">    <span class="keyword">if</span> lr:</span><br><span class="line">        try:</span><br><span class="line">            json_ = request.json</span><br><span class="line">            query = pd.get_dummies(pd.DataFrame(json_))</span><br><span class="line">            query = query.reindex(columns=model_columns, fill_value=0)</span><br><span class="line">            prediction = list(lr.predict(query))</span><br><span class="line">            <span class="built_in">return</span> jsonify(&#123;<span class="string">&#x27;prediction&#x27;</span>: str(prediction)&#125;)</span><br><span class="line">        except:</span><br><span class="line">            <span class="built_in">return</span> jsonify(&#123;<span class="string">&#x27;trace&#x27;</span>: traceback.format_exc()&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Train the model first&#x27;</span>)</span><br><span class="line">        <span class="built_in">return</span> <span class="string">&#x27;No model here to use&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.externals import joblib</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        port = int(sys.argv[1])  </span><br><span class="line">    except:</span><br><span class="line">        port = 8000  </span><br><span class="line">    lr = joblib.load(<span class="string">&#x27;model.pkl&#x27;</span>)  <span class="comment"># Load &quot;model.pkl&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Model loaded&#x27;</span>)</span><br><span class="line">    model_columns = joblib.load(<span class="string">&#x27;model_columns.pkl&#x27;</span>)  <span class="comment"># Load &quot;model_columns.pkl&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Model columns loaded&#x27;</span>)</span><br><span class="line">    app.run(host=<span class="string">&#x27;192.168.100.162&#x27;</span>, port=port, debug=True)</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://shuo-shuo.site/2023/08/04/Hadoop%E7%94%9F%E6%80%81%E5%9C%88%E4%B8%8EHDFS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sure Zheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sure's BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/04/Hadoop%E7%94%9F%E6%80%81%E5%9C%88%E4%B8%8EHDFS/" class="post-title-link" itemprop="url">Hadoop 生态圈与 HDFS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-04 23:24:27" itemprop="dateCreated datePublished" datetime="2023-08-04T23:24:27+08:00">2023-08-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-08-14 22:33:12" itemprop="dateModified" datetime="2023-08-14T22:33:12+08:00">2023-08-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>670</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Hadoop 的核心是 YARN，HDFS 和 Mapreduce</p>
<h1 id="HDFS-分布式文件系统"><a href="#HDFS-分布式文件系统" class="headerlink" title="HDFS 分布式文件系统"></a>HDFS 分布式文件系统</h1><ul>
<li>HDFS 是 Hadoop 分布式文件系统</li>
<li>HDFS采用了主从（Master/Slave）结构模型，一个HDFS集群包括一个名称节点（ NameNode）和若干个数据节点（DataNode）。</li>
<li>存储离线数据，先通过 hdfs 做理想处理</li>
<li>模型训练的时候，也通过挂载hdfs的方式直接读取tensor进行训练</li>
<li>一次写入多次读取机制</li>
</ul>
<figure class="highlight bash"><figcaption><span>列出所有目录和文件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -<span class="built_in">ls</span>  /</span><br></pre></td></tr></table></figure>

<h1 id="Hadoop-的计算系统：MapReduce"><a href="#Hadoop-的计算系统：MapReduce" class="headerlink" title="Hadoop 的计算系统：MapReduce"></a>Hadoop 的计算系统：MapReduce</h1><ul>
<li>map，做数据映射，从json文件中读取想要字段</li>
<li>reduce，做数据汇总，计算平均数、中位数等</li>
<li>分布式处理，map阶段对hdfs中每一个文件设置map读文件；同步并行reduce对map进行加工</li>
</ul>
<h1 id="Hive-数据仓库"><a href="#Hive-数据仓库" class="headerlink" title="Hive - 数据仓库"></a>Hive - 数据仓库</h1><p>基于 Hadoop 的一个数据仓库工具，提供简单的sql查询功能</p>
<ul>
<li>解决数据存储、处理和计算问题</li>
<li>数据关联：点击数据、商品数据，计算出用户点击的商品信息</li>
</ul>
<h1 id="Hbase-数据库-分布式列存数据库"><a href="#Hbase-数据库-分布式列存数据库" class="headerlink" title="Hbase 数据库 - 分布式列存数据库"></a>Hbase 数据库 - 分布式列存数据库</h1><p>基于 Hadoop 的数据库，分布式、可扩展的 Nosql数据库，提供内存 Hash 表，通过存储索引来查询</p>
<ul>
<li>解决实时数据查询问题</li>
<li>采用 BigTable数据模型，增加 KV 映射</li>
</ul>
<h1 id="zookeeper-分布式协作服务"><a href="#zookeeper-分布式协作服务" class="headerlink" title="zookeeper - 分布式协作服务"></a>zookeeper - 分布式协作服务</h1><p>为分布式应用提供一致性服务的组件：配置维护、域名维护、分布式同步</p>
<h1 id="Yarn-分布式资源管理器"><a href="#Yarn-分布式资源管理器" class="headerlink" title="Yarn - 分布式资源管理器"></a>Yarn - 分布式资源管理器</h1><p>分布式的操作系统平台</p>
<ul>
<li>Resource Manager，负责所有资源的监控、分配和管理 </li>
<li>Node Mangaer，负责每一个节点的维护</li>
<li>Application Master，负责每一个具体应用程序的调度和协调</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Sure Zheng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/Categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/shuo-zh" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;shuo-zh" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="gmail:zhengdashuo007@gmail.com" title="E-Mail → gmail:zhengdashuo007@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/san_zheng" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;san_zheng" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="/shuo-zh.github.io" title="shuo-zh.github.io">BLOG</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sure Zheng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
